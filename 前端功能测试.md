# 前端功能测试指南

## ✅ 已完成的前端功能

### 1. **页面路由**
- ✅ `/` - 仪表盘（Dashboard）
- ✅ `/users` - 用户管理
- ✅ `/orders` - 订单管理
- ✅ 侧边栏导航菜单

### 2. **用户管理页面** (`/users`)
- ✅ 用户列表（表格展示）
- ✅ 注册新用户（不绑定卡号）
- ✅ 注册新用户并绑定卡号
- ✅ 绑定 RFID 卡号功能
- ✅ 用户状态筛选
- ✅ 余额排序

### 3. **订单管理页面** (`/orders`)
- ✅ 订单列表（表格展示）
- ✅ 订单详情查看
- ✅ 订单统计卡片
- ✅ 状态筛选（进行中/已完成/已取消）
- ✅ 日期范围筛选
- ✅ 费用和时长排序

### 4. **仪表盘页面** (`/`)
- ✅ 统计卡片（总车辆、骑行中、今日订单、今日收入）
- ✅ 实时地图（简化版）
- ✅ 车辆控制面板
- ✅ MQTT 连接状态

---

## 🚀 启动测试

### 1. 启动后端（新终端）

```bash
cd backend
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 启动前端（新终端）

```bash
cd frontend
npm run dev
```

### 3. 访问应用

打开浏览器访问：
- **应用主页**: http://localhost:5173
- **API 文档**: http://localhost:8000/docs

---

## 📋 功能测试清单

### 基础导航测试

- [ ] 页面正常加载，无报错
- [ ] 侧边栏菜单显示正常
- [ ] 点击菜单可以切换页面
- [ ] 浏览器前进/后退按钮正常工作
- [ ] URL 路由正确显示

### 仪表盘测试 (`/`)

- [ ] **统计卡片显示**
  - [ ] 总车辆数显示正确
  - [ ] 骑行中数量显示正确
  - [ ] 今日订单显示正确
  - [ ] 今日收入显示正确

- [ ] **地图功能**
  - [ ] 地图区域显示正常
  - [ ] 车辆标记显示（3辆测试车）
  - [ ] 点击标记显示详情面板
  - [ ] 详情面板显示车辆信息

- [ ] **控制面板**
  - [ ] 车辆列表显示正确
  - [ ] 筛选器工作正常（全部/空闲/骑行中/故障）
  - [ ] 搜索框可以搜索车辆编号
  - [ ] 刷新按钮重新加载数据

- [ ] **MQTT 状态**
  - [ ] 显示 MQTT 连接状态（可能显示"断开"，这是正常的）

### 用户管理测试 (`/users`)

#### 查看用户列表
- [ ] 表格显示所有用户
- [ ] 显示用户基本信息（ID、用户名、手机号、卡号、余额、状态）
- [ ] 未绑定卡的用户显示"绑定卡号"按钮
- [ ] 已绑定卡的用户显示绿色 Tag

#### 注册新用户（不绑定卡号）
1. 点击"注册用户"按钮
2. 填写表单：
   - 用户名：测试用户001
   - 手机号：13800138000
   - 初始余额：50
3. 点击确定
- [ ] 提示"用户注册成功"
- [ ] 用户列表新增一行
- [ ] 新用户的 rfid_card 为 null

#### 注册新用户并绑定卡号
1. 点击"注册并绑定卡"按钮
2. 填写表单：
   - 用户名：测试用户002
   - 手机号：13900139000
   - RFID 卡号：TEST1234
   - 初始余额：100
3. 点击确定
- [ ] 提示"用户注册并绑定卡成功"
- [ ] 用户列表新增一行
- [ ] 新用户显示绿色卡号 Tag

#### 绑定卡号
1. 找到一个未绑定卡的用户
2. 点击该行的"绑定卡号"按钮
3. 输入卡号：CARD5678
4. 点击确定
- [ ] 提示"卡号绑定成功"
- [ ] 用户列表更新，显示绿色卡号 Tag

#### 错误处理测试
- [ ] 注册时输入已存在的卡号 → 提示错误
- [ ] 绑定时输入已绑定的卡号 → 提示错误
- [ ] 手机号格式不正确 → 提示错误

### 订单管理测试 (`/orders`)

#### 查看订单列表
- [ ] 表格显示所有订单
- [ ] 显示订单详细信息
- [ ] 统计卡片显示正确（总订单、进行中、已完成、总收入）

#### 筛选功能
- [ ] 状态筛选：选择"已完成" → 只显示已完成订单
- [ ] 日期筛选：选择日期范围 → 只显示该范围内的订单
- [ ] 清除筛选 → 显示所有订单

#### 查看订单详情
1. 点击任意订单的"详情"按钮
- [ ] 模态框显示订单完整信息
- [ ] 显示开始/结束时间、时长、费用、位置等
- [ ] 状态显示正确的颜色

#### 排序功能
- [ ] 点击"订单 ID"列头 → 按ID排序
- [ ] 点击"开始时间"列头 → 按时间排序
- [ ] 点击"费用"列头 → 按费用排序

---

## 🧪 API 接口测试

### 在浏览器中测试

访问 http://localhost:8000/docs，测试以下接口：

#### 用户相关

1. **注册用户（不绑定卡号）**
   - `POST /api/auth/register`
   ```json
   {
     "username": "API测试用户",
     "phone": "13700000000",
     "balance": 50
   }
   ```

2. **注册并绑定卡号**
   - `POST /api/auth/register-with-card`
   ```json
   {
     "username": "API测试用户2",
     "phone": "13700000001",
     "rfid_card": "API001",
     "balance": 50
   }
   ```

3. **绑定卡号**
   - `POST /api/users/{user_id}/bind-card`
   ```json
   {
     "rfid_card": "API002"
   }
   ```

4. **自动注册**
   - `POST /api/auth/auto-register`
   ```json
   {
     "rfid_card": "AUTO001",
     "username": "自动注册",
     "initial_balance": 50
   }
   ```

#### 验证结果
- [ ] 所有接口返回正确的数据
- [ ] 数据库 rfid_card 字段允许为 NULL
- [ ] 卡号唯一性约束正常工作

---

## 🐛 常见问题

### 问题1：前端页面空白

**症状**：访问 http://localhost:5173 显示空白页面

**解决方案**：
1. 检查浏览器控制台是否有错误
2. 确认后端是否正常运行
3. 检查 Vite 配置中的代理设置

### 问题2：路由无法跳转

**症状**：点击菜单没有反应

**解决方案**：
1. 检查 `react-router-dom` 是否安装成功
2. 确认 `App.jsx` 中的路由配置正确
3. 查看浏览器控制台的路由错误

### 问题3：API 请求失败

**症状**：前端报错 `Network Error`

**解决方案**：
1. 确认后端正在运行（访问 http://localhost:8000/health）
2. 检查 CORS 配置
3. 查看浏览器 Network 标签，确认请求 URL

### 问题4：数据库连接错误

**症状**：后端无法连接 MySQL

**解决方案**：
1. 确认 MySQL 容器正在运行：`cd docker && docker-compose ps`
2. 检查端口是否正确（3307）
3. 查看 MySQL 日志：`cd docker && docker-compose logs mysql`

---

## 📝 测试数据说明

### 初始测试数据

数据库已初始化以下测试数据：

**用户：**
- ID 1: RFID A3F5C2D1, 测试用户1, 余额 50
- ID 2: RFID B7E9A4F2, 测试用户2, 余额 30

**车辆：**
- BIKE_001: 空闲, 位置 39.915, 116.404
- BIKE_002: 空闲, 位置 39.916, 116.405
- BIKE_003: 骑行中, 位置 39.917, 116.406

---

## 🎯 下一步开发建议

### 功能完善
1. **添加编辑用户功能**
2. **添加用户充值功能**
3. **添加订单轨迹地图回放**
4. **添加数据统计图表（ECharts）**

### 性能优化
1. **添加数据缓存**
2. **使用虚拟滚动优化长列表**
3. **添加骨架屏加载**
4. **优化图片加载**

### 用户体验
1. **添加全局错误边界**
2. **添加全局 Loading**
3. **添加操作成功/失败提示**
4. **优化移动端适配**

---

## 📱 浏览器兼容性

推荐使用以下浏览器测试：
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Edge 90+
- ⚠️ Safari 14+（可能有部分功能不兼容）

---

## ✅ 测试完成后

如果所有测试通过，您可以：

1. **提交代码到版本控制**
2. **准备部署到生产环境**
3. **开始 ESP8266 固件开发**
4. **完善项目文档**

---

祝测试顺利！🎉
