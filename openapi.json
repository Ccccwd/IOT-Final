{"openapi":"3.1.0","info":{"title":"智能共享单车管理系统 API","description":"基于 FastAPI + MySQL + MQTT 的共享单车后端服务","version":"1.0.0"},"paths":{"/":{"get":{"summary":"Root","description":"根路径","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/health":{"get":{"summary":"Health Check","description":"健康检查","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/auth/register":{"post":{"tags":["用户认证"],"summary":"Register User","description":"注册新用户（不需要提供卡号）","operationId":"register_user_api_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/register-with-card":{"post":{"tags":["用户认证"],"summary":"Register User With Card","description":"注册新用户并绑定卡号","operationId":"register_user_with_card_api_auth_register_with_card_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreateWithCard"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/topup":{"post":{"tags":["用户认证"],"summary":"Topup Balance","description":"用户充值","operationId":"topup_balance_api_auth_topup_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserTopup"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users":{"get":{"tags":["用户管理"],"summary":"Get Users","description":"获取用户列表","operationId":"get_users_api_users_get","parameters":[{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserResponse"},"title":"Response Get Users Api Users Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users/{user_id}":{"get":{"tags":["用户管理"],"summary":"Get User","description":"获取用户详情","operationId":"get_user_api_users__user_id__get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["用户管理"],"summary":"Update User","description":"更新用户信息（不包括RFID卡号）","operationId":"update_user_api_users__user_id__put","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/users/{user_id}/bind-card":{"post":{"tags":["用户管理"],"summary":"Bind Card","description":"为用户绑定 RFID 卡","operationId":"bind_card_api_users__user_id__bind_card_post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BindCardRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/auto-register":{"post":{"tags":["用户认证"],"summary":"Auto Register","description":"硬件端自动注册（刷卡自动创建用户）","operationId":"auto_register_api_auth_auto_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoRegisterRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/bikes":{"get":{"tags":["车辆管理"],"summary":"Get Bikes","description":"获取车辆列表","operationId":"get_bikes_api_bikes_get","parameters":[{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}},{"name":"status","in":"query","required":false,"schema":{"type":"string","title":"Status"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BikeListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/bikes/{bike_id}":{"get":{"tags":["车辆管理"],"summary":"Get Bike","description":"获取车辆详情","operationId":"get_bike_api_bikes__bike_id__get","parameters":[{"name":"bike_id","in":"path","required":true,"schema":{"type":"integer","title":"Bike Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BikeResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/bikes/{bike_id}/status":{"patch":{"tags":["车辆管理"],"summary":"Update Bike Status","description":"更新车辆状态","operationId":"update_bike_status_api_bikes__bike_id__status_patch","parameters":[{"name":"bike_id","in":"path","required":true,"schema":{"type":"integer","title":"Bike Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BikeUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BikeResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/bikes/{bike_id}/trajectory":{"get":{"tags":["车辆管理"],"summary":"Get Bike Trajectory","description":"获取车辆轨迹","operationId":"get_bike_trajectory_api_bikes__bike_id__trajectory_get","parameters":[{"name":"bike_id","in":"path","required":true,"schema":{"type":"integer","title":"Bike Id"}},{"name":"order_id","in":"query","required":false,"schema":{"type":"integer","title":"Order Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/orders/unlock":{"post":{"tags":["订单管理"],"summary":"Unlock Bike","description":"开锁（创建订单）","operationId":"unlock_bike_api_orders_unlock_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderUnlock"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/orders/lock":{"post":{"tags":["订单管理"],"summary":"Lock Bike","description":"还车（结束订单）","operationId":"lock_bike_api_orders_lock_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderLock"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LockResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/orders":{"get":{"tags":["订单管理"],"summary":"Get Orders","description":"获取订单列表","operationId":"get_orders_api_orders_get","parameters":[{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}},{"name":"user_id","in":"query","required":false,"schema":{"type":"integer","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/OrderResponse"},"title":"Response Get Orders Api Orders Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/orders/{order_id}":{"get":{"tags":["订单管理"],"summary":"Get Order","description":"获取订单详情","operationId":"get_order_api_orders__order_id__get","parameters":[{"name":"order_id","in":"path","required":true,"schema":{"type":"integer","title":"Order Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrderResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/auth/validate-card":{"post":{"tags":["硬件认证"],"summary":"Validate Card","description":"验证 RFID 卡（硬件端调用）","operationId":"validate_card_api_auth_validate_card_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RFIDAuthRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RFIDAuthResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/command":{"post":{"tags":["管理员"],"summary":"Admin Command","description":"管理员远程控制","operationId":"admin_command_api_admin_command_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AdminCommand"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessageResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/dashboard":{"get":{"tags":["管理员"],"summary":"Get Dashboard","description":"获取仪表盘统计数据","operationId":"get_dashboard_api_admin_dashboard_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DashboardStats"}}}}}}},"/api/admin/statistics/trends":{"get":{"tags":["管理员"],"summary":"Get Statistics Trends","description":"获取指定天数的统计数据趋势","operationId":"get_statistics_trends_api_admin_statistics_trends_get","parameters":[{"name":"days","in":"query","required":false,"schema":{"type":"integer","default":7,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AdminCommand":{"properties":{"bike_id":{"type":"integer","title":"Bike Id"},"command":{"type":"string","pattern":"^(force_unlock|force_lock)$","title":"Command"},"reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason","default":"管理员远程操作"}},"type":"object","required":["bike_id","command"],"title":"AdminCommand","description":"管理员远程控制"},"AutoRegisterRequest":{"properties":{"rfid_card":{"type":"string","maxLength":20,"minLength":1,"title":"Rfid Card","description":"RFID 卡号"},"username":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Username","description":"用户名","default":"新用户"},"initial_balance":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Initial Balance","description":"初始余额","default":50.0}},"type":"object","required":["rfid_card"],"title":"AutoRegisterRequest","description":"硬件端自动注册请求（刷卡自动创建用户）"},"BikeListResponse":{"properties":{"total":{"type":"integer","title":"Total"},"items":{"items":{"$ref":"#/components/schemas/BikeResponse"},"type":"array","title":"Items"}},"type":"object","required":["total","items"],"title":"BikeListResponse","description":"车辆列表响应"},"BikeResponse":{"properties":{"bike_code":{"type":"string","maxLength":20,"minLength":1,"title":"Bike Code","description":"车辆编号"},"id":{"type":"integer","title":"Id"},"status":{"type":"string","title":"Status"},"current_lat":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Current Lat"},"current_lng":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Current Lng"},"battery":{"type":"integer","title":"Battery"},"last_heartbeat":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Heartbeat"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["bike_code","id","status","current_lat","current_lng","battery","last_heartbeat","created_at","updated_at"],"title":"BikeResponse","description":"车辆响应"},"BikeUpdate":{"properties":{"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status"},"current_lat":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Current Lat"},"current_lng":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Current Lng"},"battery":{"anyOf":[{"type":"integer","maximum":100.0,"minimum":0.0},{"type":"null"}],"title":"Battery"}},"type":"object","title":"BikeUpdate","description":"更新车辆"},"BindCardRequest":{"properties":{"rfid_card":{"type":"string","maxLength":20,"minLength":1,"title":"Rfid Card","description":"RFID 卡号"}},"type":"object","required":["rfid_card"],"title":"BindCardRequest","description":"绑定卡号请求"},"DashboardStats":{"properties":{"total_bikes":{"type":"integer","title":"Total Bikes"},"idle_bikes":{"type":"integer","title":"Idle Bikes"},"riding_bikes":{"type":"integer","title":"Riding Bikes"},"fault_bikes":{"type":"integer","title":"Fault Bikes"},"total_users":{"type":"integer","title":"Total Users"},"today_orders":{"type":"integer","title":"Today Orders"},"today_revenue":{"type":"number","title":"Today Revenue"}},"type":"object","required":["total_bikes","idle_bikes","riding_bikes","fault_bikes","total_users","today_orders","today_revenue"],"title":"DashboardStats","description":"仪表盘统计数据"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LockResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"duration_minutes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Duration Minutes"},"distance_km":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Distance Km"},"cost":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Cost"},"new_balance":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"New Balance"},"message":{"type":"string","title":"Message"}},"type":"object","required":["success","message"],"title":"LockResponse","description":"还车响应"},"MessageResponse":{"properties":{"message":{"type":"string","title":"Message"},"success":{"type":"boolean","title":"Success","default":true}},"type":"object","required":["message"],"title":"MessageResponse","description":"通用消息响应"},"OrderLock":{"properties":{"order_id":{"type":"integer","title":"Order Id"},"rfid_card":{"type":"string","title":"Rfid Card"},"end_lat":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"End Lat"},"end_lng":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"End Lng"}},"type":"object","required":["order_id","rfid_card","end_lat","end_lng"],"title":"OrderLock","description":"还车（结束订单）"},"OrderResponse":{"properties":{"id":{"type":"integer","title":"Id"},"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id"},"bike_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Bike Id"},"start_time":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Start Time"},"end_time":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"End Time"},"duration_minutes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Duration Minutes"},"start_lat":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Start Lat"},"start_lng":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Start Lng"},"end_lat":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"End Lat"},"end_lng":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"End Lng"},"cost":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Cost"},"distance_km":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Distance Km"},"status":{"type":"string","title":"Status"},"created_at":{"type":"string","format":"date-time","title":"Created At"}},"type":"object","required":["id","user_id","bike_id","start_time","end_time","duration_minutes","start_lat","start_lng","end_lat","end_lng","cost","distance_km","status","created_at"],"title":"OrderResponse","description":"订单响应"},"OrderUnlock":{"properties":{"bike_id":{"type":"integer","title":"Bike Id"},"rfid_card":{"type":"string","title":"Rfid Card"},"lat":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"Lat","description":"纬度"},"lng":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"Lng","description":"经度"}},"type":"object","required":["bike_id","rfid_card","lat","lng"],"title":"OrderUnlock","description":"开锁（创建订单）"},"RFIDAuthRequest":{"properties":{"rfid_uid":{"type":"string","maxLength":20,"minLength":1,"title":"Rfid Uid"},"bike_id":{"type":"integer","title":"Bike Id"},"action":{"type":"string","pattern":"^(unlock|lock)$","title":"Action","description":"操作类型：unlock 或 lock"}},"type":"object","required":["rfid_uid","bike_id","action"],"title":"RFIDAuthRequest","description":"RFID 认证请求"},"RFIDAuthResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"message":{"type":"string","title":"Message"},"user_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"User Id"},"balance":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Balance"},"order_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Order Id"}},"type":"object","required":["success","message"],"title":"RFIDAuthResponse","description":"RFID 认证响应"},"UserCreate":{"properties":{"username":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Username","description":"用户名"},"phone":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Phone","description":"手机号"},"password":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Password","description":"密码（可选）"},"balance":{"anyOf":[{"type":"number","minimum":0.0},{"type":"null"}],"title":"Balance","description":"初始余额","default":50.0}},"type":"object","title":"UserCreate","description":"创建用户（注册时不需要卡号）"},"UserCreateWithCard":{"properties":{"username":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Username","description":"用户名"},"phone":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Phone","description":"手机号"},"password":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Password","description":"密码（可选）"},"balance":{"anyOf":[{"type":"number","minimum":0.0},{"type":"null"}],"title":"Balance","description":"初始余额","default":50.0},"rfid_card":{"type":"string","maxLength":20,"minLength":1,"title":"Rfid Card","description":"RFID 卡号"}},"type":"object","required":["rfid_card"],"title":"UserCreateWithCard","description":"创建用户并绑定卡号"},"UserResponse":{"properties":{"username":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Username","description":"用户名"},"phone":{"anyOf":[{"type":"string","maxLength":20},{"type":"null"}],"title":"Phone","description":"手机号"},"id":{"type":"integer","title":"Id"},"rfid_card":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Rfid Card"},"balance":{"type":"number","title":"Balance"},"status":{"type":"string","title":"Status"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["id","balance","status","created_at","updated_at"],"title":"UserResponse","description":"用户响应"},"UserTopup":{"properties":{"user_id":{"type":"integer","title":"User Id"},"amount":{"type":"number","exclusiveMinimum":0.0,"title":"Amount","description":"充值金额"}},"type":"object","required":["user_id","amount"],"title":"UserTopup","description":"用户充值"},"UserUpdate":{"properties":{"username":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Username"},"phone":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Phone"},"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status"}},"type":"object","title":"UserUpdate","description":"更新用户"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}