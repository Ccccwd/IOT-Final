# ESP8266 ç¡¬ä»¶è°ƒè¯•æŒ‡å—

## ğŸ“š ç›®å½•

1. [å¼€å‘ç¯å¢ƒå‡†å¤‡](#å¼€å‘ç¯å¢ƒå‡†å¤‡)
2. [å•ä¸ªæ¨¡å—æµ‹è¯•](#å•ä¸ªæ¨¡å—æµ‹è¯•)
3. [å®Œæ•´ç³»ç»Ÿè°ƒè¯•](#å®Œæ•´ç³»ç»Ÿè°ƒè¯•)
4. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
5. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒå‡†å¤‡

### 1.1 å®‰è£… Arduino IDE

**æ­¥éª¤**ï¼š

1. è®¿é—® [Arduino å®˜ç½‘](https://www.arduino.cc/en/software)
2. ä¸‹è½½é€‚ç”¨äºä½ æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ï¼ˆWindows/macOS/Linuxï¼‰
3. å®‰è£… Arduino IDE

**éªŒè¯å®‰è£…**ï¼š
- æ‰“å¼€ Arduino IDE
- ç‚¹å‡» `å·¥å…·` â†’ `å¼€å‘æ¿` â†’ çœ‹åˆ°å¼€å‘æ¿åˆ—è¡¨

---

### 1.2 æ·»åŠ  ESP8266 å¼€å‘æ¿æ”¯æŒ

**æ­¥éª¤**ï¼š

1. æ‰“å¼€ Arduino IDE
2. ç‚¹å‡» `æ–‡ä»¶` â†’ `é¦–é€‰é¡¹`
3. åœ¨ `é™„åŠ å¼€å‘æ¿ç®¡ç†å™¨ç½‘å€` ä¸­æ·»åŠ ï¼š
   ```
   http://arduino.esp8266.com/stable/package_esp8266com_index.json
   ```
4. ç‚¹å‡» `ç¡®å®š`

5. ç‚¹å‡» `å·¥å…·` â†’ `å¼€å‘æ¿` â†’ `å¼€å‘æ¿ç®¡ç†å™¨`
6. æœç´¢ `esp8266`
7. ç‚¹å‡» `esp8266 by ESP8266 Community` â†’ `å®‰è£…`
8. å®‰è£…å®Œæˆåé€‰æ‹©ï¼š`å·¥å…·` â†’ `å¼€å‘æ¿` â†’ `ESP8266 Boards` â†’ `NodeMCU 1.0 (ESP-12E Module)`

---

### 1.3 å®‰è£…å¿…éœ€çš„åº“

**æ–¹æ³•ä¸€ï¼šé€šè¿‡åº“ç®¡ç†å™¨å®‰è£…ï¼ˆæ¨èï¼‰**

1. ç‚¹å‡» `é¡¹ç›®` â†’ `åŠ è½½åº“` â†’ `ç®¡ç†åº“`
2. æœç´¢å¹¶å®‰è£…ä»¥ä¸‹åº“ï¼š

| åº“åç§° | ä½œè€… | ç‰ˆæœ¬è¦æ±‚ | ç”¨é€” |
|--------|------|---------|------|
| PubSubClient | Nick O'Leary | 2.8.0+ | MQTT é€šä¿¡ |
| ArduinoJson | Benoit Blanchon | 6.21.0+ | JSON å¤„ç† |
| MFRC522 | miguelbalboa | 1.4.10+ | RFID è¯»å¡å™¨ |
| TinyGPSPlus | Mikal Hart | 1.0.3+ | GPS è§£æ |
| U8g2 | olikraus | 2.34.0+ | OLED æ˜¾ç¤º |

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…**

1. ä» GitHub ä¸‹è½½åº“çš„ ZIP æ–‡ä»¶
2. ç‚¹å‡» `é¡¹ç›®` â†’ `åŠ è½½åº“` â†’ `æ·»åŠ  .ZIP åº“`
3. é€‰æ‹©ä¸‹è½½çš„ ZIP æ–‡ä»¶

---

### 1.4 é…ç½® Arduino IDE

**é’ˆå¯¹ NodeMCU 1.0 çš„æ¨èé…ç½®**ï¼š

```
å·¥å…· â†’ å¼€å‘æ¿: NodeMCU 1.0 (ESP-12E Module)
å·¥å…· â†’ Upload Speed: 115200
å·¥å…· â†’ CPU Frequency: 80 MHz
å·¥å…· â†’ Flash Size: 4M (3M SPIFFS)
å·¥å…· â†’ LWIP Variant: v2 Lower Memory
å·¥å…· â†’ Reset Method: nodemcu
å·¥å…· â†’ ç«¯å£: COM3 (æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©)
```

---

## ğŸ”§ å•ä¸ªæ¨¡å—æµ‹è¯•

### 2.1 æµ‹è¯• ESP8266 åŸºç¡€åŠŸèƒ½

**æµ‹è¯•ä»£ç **ï¼š

```cpp
void setup() {
  Serial.begin(9600);
  pinMode(LED_BUILTIN, OUTPUT);
  Serial.println("\n\nESP8266 åŸºç¡€æµ‹è¯•");
  Serial.println("æ¿è½½ LED åº”è¯¥å¼€å§‹é—ªçƒ...");
}

void loop() {
  digitalWrite(LED_BUILTIN, LOW);  // NodeMCU çš„ LED æ˜¯ä½ç”µå¹³ç‚¹äº®
  delay(1000);
  digitalWrite(LED_BUILTIN, HIGH);
  delay(1000);
}
```

**é¢„æœŸç»“æœ**ï¼š
- ä¸²å£ç›‘è§†å™¨è¾“å‡ºæµ‹è¯•ä¿¡æ¯
- NodeMCU æ¿è½½è“è‰² LED é—ªçƒ

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥ USB æ•°æ®çº¿ï¼ˆæœ‰äº›çº¿åªèƒ½ä¾›ç”µä¸èƒ½ä¼ è¾“æ•°æ®ï¼‰
- æ›´æ¢ USB ç«¯å£
- æŒ‰ä½ FLASH æŒ‰é’®å†ä¸Šä¼ 

---

### 2.2 æµ‹è¯• WiFi è¿æ¥

**æµ‹è¯•ä»£ç **ï¼š

```cpp
#include <ESP8266WiFi.h>

const char* ssid = "your_wifi_ssid";
const char* password = "your_wifi_password";

void setup() {
  Serial.begin(9600);
  Serial.println("\n\nWiFi è¿æ¥æµ‹è¯•");

  WiFi.begin(ssid, password);

  Serial.print("æ­£åœ¨è¿æ¥");
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("\nè¿æ¥æˆåŠŸ!");
  Serial.print("IP åœ°å€: ");
  Serial.println(WiFi.localIP());
  Serial.print("ä¿¡å·å¼ºåº¦ (RSSI): ");
  Serial.print(WiFi.RSSI());
  Serial.println(" dBm");
}

void loop() {
  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("WiFi ä»ç„¶è¿æ¥");
  } else {
    Serial.println("WiFi æ–­å¼€!");
  }
  delay(5000);
}
```

**é¢„æœŸç»“æœ**ï¼š
```
æ­£åœ¨è¿æ¥....
è¿æ¥æˆåŠŸ!
IP åœ°å€: 192.168.1.100
ä¿¡å·å¼ºåº¦ (RSSI): -45 dBm
WiFi ä»ç„¶è¿æ¥
```

**è°ƒè¯•æç¤º**ï¼š
- RSSI > -50 dBmï¼šä¿¡å·æå¥½
- RSSI -50 åˆ° -60 dBmï¼šä¿¡å·è‰¯å¥½
- RSSI < -70 dBmï¼šä¿¡å·è¾ƒå¼±
- RSSI < -80 dBmï¼šä¿¡å·å¾ˆå·®

---

### 2.3 æµ‹è¯• RFID è¯»å¡å™¨

**æ¥çº¿**ï¼š
- RFID SDA â†’ ESP8266 D3 (GPIO0)
- RFID SCK â†’ ESP8266 D1 (GPIO5)
- RFID MOSI â†’ ESP8266 D7 (GPIO13)
- RFID MISO â†’ ESP8266 D6 (GPIO12)
- RFID RST â†’ 3.3V
- RFID GND â†’ GND
- RFID 3.3V â†’ 3.3V **ï¼ˆéå¸¸é‡è¦ï¼ï¼‰**

**æµ‹è¯•ä»£ç **ï¼š

```cpp
#include <SPI.h>
#include <MFRC522.h>

#define SS_PIN 0    // D3
#define RST_PIN -1  // æ¥ 3.3V

MFRC522 rfid(SS_PIN, RST_PIN);

void setup() {
  Serial.begin(9600);
  SPI.begin();
  rfid.PCD_Init();
  rfid.PCD_SetAntennaGain(rfid.RxGain_max);

  Serial.println("\n\nRFID è¯»å¡å™¨æµ‹è¯•");

  byte version = rfid.PCD_ReadRegister(rfid.VersionReg);
  Serial.print("RC522 ç‰ˆæœ¬: 0x");
  Serial.println(version, HEX);

  if (version == 0x00 || version == 0xFF) {
    Serial.println("âŒ æœªæ£€æµ‹åˆ° RFID è¯»å¡å™¨!");
    Serial.println("è¯·æ£€æŸ¥:");
    Serial.println("1. æ¥çº¿æ˜¯å¦æ­£ç¡®");
    Serial.println("2. 3.3V ä¾›ç”µæ˜¯å¦æ­£å¸¸");
    Serial.println("3. æ¨¡å—æ˜¯å¦æŸå");
  } else {
    Serial.println("âœ… RFID è¯»å¡å™¨å·²å°±ç»ª");
    Serial.println("è¯·åˆ·å¡...");
  }
}

void loop() {
  if (rfid.PICC_IsNewCardPresent() && rfid.PICC_ReadCardSerial()) {
    Serial.print("æ£€æµ‹åˆ°å¡ç‰‡ï¼ŒUID: ");
    String uid = "";
    for (byte i = 0; i < rfid.uid.size; i++) {
      if (rfid.uid.uidByte[i] < 0x10) {
        uid += "0";
      }
      uid += String(rfid.uid.uidByte[i], HEX);
      uid += " ";
    }
    uid.toUpperCase();
    Serial.println(uid);

    // è¯»å–å¡ç‰‡ç±»å‹
    MFRC522::PICC_Type piccType = rfid.PICC_GetType(rfid.uid.sak);
    Serial.print("å¡ç‰‡ç±»å‹: ");
    Serial.println(rfid.PICC_GetTypeName(piccType));

    rfid.PICC_HaltA();
    rfid.PCD_StopCrypto1();
  }
}
```

**é¢„æœŸç»“æœ**ï¼š
```
RC522 ç‰ˆæœ¬: 0x91
âœ… RFID è¯»å¡å™¨å·²å°±ç»ª
è¯·åˆ·å¡...
æ£€æµ‹åˆ°å¡ç‰‡ï¼ŒUID: A3 F5 C2 D1
å¡ç‰‡ç±»å‹: Mifare One
```

**å¸¸è§é—®é¢˜**ï¼š

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| ç‰ˆæœ¬å· 0x00 æˆ– 0xFF | æ¨¡å—æœªè¿æ¥æˆ–æŸå | æ£€æŸ¥æ¥çº¿å’Œ 3.3V ä¾›ç”µ |
| è¯»ä¸åˆ°å¡ç‰‡ | è·ç¦»å¤ªè¿œæˆ–å¡ç‰‡æŸå | è°ƒæ•´è·ç¦» 2-5cm |
| UID å˜åŒ– | å¡ç‰‡ç§»åŠ¨ | ä¿æŒå¡ç‰‡é™æ­¢ |

---

### 2.4 æµ‹è¯• GPS æ¨¡å—

**æ¥çº¿**ï¼š
- GPS TX â†’ ESP8266 RX (GPIO3)
- GPS RX â†’ ESP8266 TX (GPIO1)
- GPS VCC â†’ 3.3V
- GPS GND â†’ GND

**æµ‹è¯•ä»£ç **ï¼š

```cpp
#include <TinyGPS++.h>

TinyGPSPlus gps;
HardwareSerial GPSSerial(1); // Serial1

void setup() {
  Serial.begin(9600);
  GPSSerial.begin(9600);

  Serial.println("\n\nGPS æ¨¡å—æµ‹è¯•");
  Serial.println("è¯·å°† GPS æ”¾åœ¨çª—è¾¹æˆ–å®¤å¤–...");
  Serial.println("å†·å¯åŠ¨éœ€è¦ 1-5 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…...");
}

void loop() {
  while (GPSSerial.available() > 0) {
    gps.encode(GPSSerial.read());
  }

  // æ¯ 5 ç§’è¾“å‡ºä¸€æ¬¡çŠ¶æ€
  static unsigned long lastPrint = 0;
  if (millis() - lastPrint > 5000) {
    if (gps.location.isUpdated()) {
      Serial.println("âœ… GPS å®šä½æˆåŠŸ!");
      Serial.print("ç»åº¦: ");
      Serial.println(gps.location.lng(), 6);
      Serial.print("çº¬åº¦: ");
      Serial.println(gps.location.lat(), 6);
      Serial.print("æµ·æ‹”: ");
      Serial.print(gps.altitude.meters());
      Serial.println(" ç±³");
      Serial.print("å«æ˜Ÿæ•°: ");
      Serial.println(gps.satellites.value());
      Serial.print("HDOP (ç²¾åº¦): ");
      Serial.println(gps.hdop.value());
    } else {
      Serial.println("â³ æ­£åœ¨æœç´¢å«æ˜Ÿ...");

      if (gps.charsProcessed() < 10) {
        Serial.println("âŒ é”™è¯¯: æœªæ¥æ”¶åˆ° GPS æ•°æ®!");
        Serial.println("è¯·æ£€æŸ¥:");
        Serial.println("1. TX/RX æ˜¯å¦æ¥å");
        Serial.println("2. æ³¢ç‰¹ç‡æ˜¯å¦ä¸º 9600");
        Serial.println("3. å¤©çº¿æ˜¯å¦è¿æ¥");
      }
    }
    lastPrint = millis();
  }
}
```

**é¢„æœŸç»“æœ**ï¼š
```
â³ æ­£åœ¨æœç´¢å«æ˜Ÿ...
â³ æ­£åœ¨æœç´¢å«æ˜Ÿ...
âœ… GPS å®šä½æˆåŠŸ!
ç»åº¦: 120.155123
çº¬åº¦: 30.274567
æµ·æ‹”: 45.2 ç±³
å«æ˜Ÿæ•°: 8
HDOP (ç²¾åº¦): 120
```

**GPS å®šä½è´¨é‡è¯„ä¼°**ï¼š

| HDOP å€¼ | å®šä½ç²¾åº¦ | è¯„ä»· |
|---------|---------|------|
| 1-2 | < 5 ç±³ | æå¥½ |
| 3-4 | 5-10 ç±³ | è‰¯å¥½ |
| 5-10 | 10-20 ç±³ | ä¸€èˆ¬ |
| > 10 | > 20 ç±³ | è¾ƒå·® |

**åŠ é€Ÿå®šä½æŠ€å·§**ï¼š
1. ä½¿ç”¨ **è¾…åŠ©å¯åŠ¨æ•°æ®ï¼ˆA-GPSï¼‰**
2. åœ¨ **å®¤å¤–ç©ºæ—·å¤„** é¦–æ¬¡å®šä½
3. ä¿æŒ **å¤©çº¿æ°´å¹³æœä¸Š**
4. é¿å…å»ºç­‘ç‰©é®æŒ¡

---

### 2.5 æµ‹è¯• OLED æ˜¾ç¤ºå±

**æ¥çº¿ï¼ˆSPI æ¥å£ï¼‰**ï¼š
- OLED GND â†’ GND
- OLED VCC â†’ 3.3V
- OLED SCK â†’ D1 (GPIO5)
- OLED SDA â†’ D5 (GPIO14)
- OLED RES â†’ D0 (GPIO16)
- OLED DC â†’ D4 (GPIO2)
- OLED CS â†’ D8 (GPIO15)

**æµ‹è¯•ä»£ç **ï¼š

```cpp
#include <U8g2lib.h>

// 4 çº¿ SPI
U8G2_SSD1306_128X64_NONAME_F_4W_SW_SPI u8g2(
  U8G2_R0,
  /* clock=*/ 5,    // SCK -> D1
  /* data=*/ 14,    // SDA -> D5
  /* cs=*/ 15,      // CS  -> D8
  /* dc=*/ 2,       // DC  -> D4
  /* reset=*/ 16    // RES -> D0
);

void setup() {
  Serial.begin(9600);
  u8g2.begin();
  u8g2.enableUTF8Print();

  Serial.println("\n\nOLED æ˜¾ç¤ºå±æµ‹è¯•");

  // æµ‹è¯• 1ï¼šæ˜¾ç¤ºæ–‡å­—
  u8g2.clearBuffer();
  u8g2.setFont(u8g2_font_ncenB14_tr);
  u8g2.setCursor(0, 20);
  u8g2.print("OLED æµ‹è¯•");
  u8g2.sendBuffer();

  Serial.println("å¦‚æœå±å¹•æ˜¾ç¤ºæ–‡å­—ï¼Œæµ‹è¯•é€šè¿‡!");

  delay(2000);

  // æµ‹è¯• 2ï¼šæ˜¾ç¤ºå›¾å½¢
  u8g2.clearBuffer();
  u8g2.drawBox(10, 10, 108, 44);
  u8g2.drawCircle(64, 32, 20);
  u8g2.sendBuffer();

  delay(2000);

  // æµ‹è¯• 3ï¼šå¯¹æ¯”åº¦è°ƒèŠ‚
  Serial.println("è°ƒèŠ‚å¯¹æ¯”åº¦...");
  for (int i = 0; i < 255; i += 5) {
    u8g2.setContrast(i);
    u8g2.clearBuffer();
    u8g2.setFont(u8g2_font_ncenB10_tr);
    u8g2.setCursor(10, 32);
    u8g2.print("Contrast: ");
    u8g2.print(i);
    u8g2.sendBuffer();
    delay(100);
  }

  u8g2.setContrast(128); // æ¢å¤é»˜è®¤å€¼
}

void loop() {
  // æ˜¾ç¤ºåŠ¨æ€æ•ˆæœ
  static int x = 0;
  u8g2.clearBuffer();
  u8g2.setFont(u8g2_font_ncenB14_tr);
  u8g2.setCursor(x, 32);
  u8g2.print("Running...");

  x = (x + 2) % 128;
  u8g2.sendBuffer();
  delay(50);
}
```

**é¢„æœŸç»“æœ**ï¼š
1. æ˜¾ç¤º "OLED æµ‹è¯•" æ–‡å­—
2. æ˜¾ç¤ºçŸ©å½¢å’Œåœ†å½¢
3. å¯¹æ¯”åº¦ä» 0 æ¸å˜åˆ° 255
4. "Running..." æ–‡å­—æ»šåŠ¨

**å¸¸è§é—®é¢˜**ï¼š

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| å±å¹•å…¨é»‘ | å¯¹æ¯”åº¦å¤ªä½æˆ–æœªåˆå§‹åŒ– | è°ƒèŠ‚å¯¹æ¯”åº¦ç”µä½å™¨ |
| å±å¹•å…¨ç™½ | æ¥çº¿é”™è¯¯æˆ– I2C/SPI ä¸åŒ¹é… | æ£€æŸ¥æ¥çº¿ï¼Œç¡®è®¤æ¥å£ç±»å‹ |
| æ˜¾ç¤ºä¹±ç  | å­—ä½“ä¸å…¼å®¹ | æ›´æ¢è‹±æ–‡å­—ä½“ |
| æ— ååº” | æœªä¾›ç”µæˆ–æ¥çº¿æ¾åŠ¨ | æ£€æŸ¥ 3.3V ä¾›ç”µ |

---

### 2.6 æµ‹è¯•èœ‚é¸£å™¨

**æ¥çº¿**ï¼š
- èœ‚é¸£å™¨æ­£æ â†’ D2 (GPIO4)
- èœ‚é¸£å™¨è´Ÿæ â†’ GNDï¼ˆé€šè¿‡ 220Î© ç”µé˜»ï¼‰

**æµ‹è¯•ä»£ç **ï¼š

```cpp
#define BUZZER_PIN 4  // D2

void setup() {
  Serial.begin(9600);
  pinMode(BUZZER_PIN, OUTPUT);

  Serial.println("\n\nèœ‚é¸£å™¨æµ‹è¯•");

  // æµ‹è¯• 1ï¼šç®€å•çš„å¼€/å…³
  Serial.println("æµ‹è¯• 1: ç®€å•å¼€/å…³");
  digitalWrite(BUZZER_PIN, HIGH);
  delay(1000);
  digitalWrite(BUZZER_PIN, LOW);
  delay(1000);

  // æµ‹è¯• 2ï¼šæ’­æ”¾éŸ³è°ƒ
  Serial.println("æµ‹è¯• 2: æ’­æ”¾éŸ³è°ƒ");
  tone(BUZZER_PIN, 1000); // 1000 Hz
  delay(500);
  noTone(BUZZER_PIN);
  delay(500);

  // æµ‹è¯• 3ï¼šæ’­æ”¾æ—‹å¾‹
  Serial.println("æµ‹è¯• 3: æ’­æ”¾æ—‹å¾‹");
  int melody[] = {262, 294, 330, 349, 392}; // Do Re Mi Fa Sol
  int noteDurations[] = {200, 200, 200, 200, 400};

  for (int i = 0; i < 5; i++) {
    tone(BUZZER_PIN, melody[i]);
    delay(noteDurations[i]);
    noTone(BUZZER_PIN);
    delay(100);
  }

  Serial.println("æµ‹è¯•å®Œæˆ!");
}

void loop() {
  // é—ªçƒæç¤º
  digitalWrite(BUZZER_PIN, HIGH);
  delay(100);
  digitalWrite(BUZZER_PIN, LOW);
  delay(1000);
}
```

**é¢„æœŸç»“æœ**ï¼š
- å¬åˆ°æŒç»­ 1 ç§’çš„èœ‚é¸£å£°
- å¬åˆ° 500Hz çš„éŸ³è°ƒ
- å¬åˆ°ç®€çŸ­çš„æ—‹å¾‹ï¼ˆDo Re Mi Fa Solï¼‰

**æ³¨æ„**ï¼š
- å¦‚æœèœ‚é¸£å™¨ä¸å¤Ÿå“ï¼Œå¯ä»¥æ”¹ç”¨ä¸‰æç®¡é©±åŠ¨
- æœ‰æºèœ‚é¸£å™¨åªèƒ½æ§åˆ¶å¼€/å…³ï¼Œä¸èƒ½æ”¹å˜éŸ³è°ƒ
- æ— æºèœ‚é¸£å™¨å¯ä»¥ä½¿ç”¨ `tone()` æ”¹å˜éŸ³è°ƒ

---

## ğŸ” å®Œæ•´ç³»ç»Ÿè°ƒè¯•

### 3.1 é›†æˆæµ‹è¯•æµç¨‹

**æ­¥éª¤ 1ï¼šä¸Šä¼ å®Œæ•´å›ºä»¶**

1. æ‰“å¼€ `firmware/bike_firmware.ino`
2. ä¿®æ”¹é…ç½®å‚æ•°ï¼š
   ```cpp
   const char* WIFI_SSID = "your_wifi_ssid";
   const char* WIFI_PASSWORD = "your_wifi_password";
   const char* API_SERVER = "192.168.1.100"; // æ”¹ä¸ºä½ çš„åç«¯ IP
   ```
3. ç‚¹å‡» `ä¸Šä¼ ` æŒ‰é’®
4. ç­‰å¾…ç¼–è¯‘å’Œä¸Šä¼ å®Œæˆ

**æ­¥éª¤ 2ï¼šæŸ¥çœ‹ä¸²å£ç›‘è§†å™¨**

1. ç‚¹å‡» `å·¥å…·` â†’ `ä¸²å£ç›‘è§†å™¨`
2. è®¾ç½®æ³¢ç‰¹ç‡ä¸º `9600`
3. è§‚å¯Ÿè¾“å‡ºä¿¡æ¯ï¼š

```
=================================
æ™ºèƒ½å…±äº«å•è½¦ç³»ç»Ÿ
ç‰ˆæœ¬: v1.0
æ—¥æœŸ: 2025-01-11
=================================
âœ… èœ‚é¸£å™¨å·²å°±ç»ª
âœ… OLED æ˜¾ç¤ºå±å·²å°±ç»ª
ğŸ“¡ RFID ç‰ˆæœ¬: 0x91
âœ… RFID è¯»å¡å™¨å·²å°±ç»ª
ğŸ“¡ GPS æ¨¡å—å·²å¯åŠ¨
â³ ç­‰å¾… GPS å®šä½ï¼ˆéœ€è¦ 1-5 åˆ†é’Ÿï¼‰...
ğŸ“¡ è¿æ¥ WiFi...
.......
âœ… WiFi å·²è¿æ¥: 192.168.1.100
ğŸ“¡ MQTT å·²é…ç½®
ğŸ“¡ å°è¯•è¿æ¥ MQTT Broker...
âœ… MQTT å·²è¿æ¥
âœ… å·²è®¢é˜…ä¸»é¢˜: server/001/command
ğŸ’“ å¿ƒè·³åŒ…å·²å‘é€
```

**æ­¥éª¤ 3ï¼šæ£€æŸ¥ OLED æ˜¾ç¤º**

åº”è¯¥çœ‹åˆ°ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™ºèƒ½å…±äº«å•è½¦     â”‚
â”‚                  â”‚
â”‚ WiFi: å·²è¿æ¥      â”‚
â”‚ GPS: æœç´¢ä¸­...    â”‚
â”‚                  â”‚
â”‚  å¾…æœºä¸­          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤ 4ï¼šæµ‹è¯•åˆ·å¡å¼€é”**

1. å‡†å¤‡ä¸€å¼ å·²æ³¨å†Œçš„ RFID å¡ï¼ˆå¡ç‰‡ UID éœ€è¦åœ¨æ•°æ®åº“ä¸­ï¼‰
2. å°†å¡ç‰‡é è¿‘è¯»å¡å™¨ï¼ˆ2-5cmï¼‰
3. è§‚å¯Ÿä¸²å£è¾“å‡ºï¼š

```
ğŸ“‡ æ£€æµ‹åˆ°å¡ç‰‡: A3F5C2D1
ğŸ”“ å¤„ç†å¼€é”è¯·æ±‚...
ğŸŒ å‘é€ HTTP è¯·æ±‚...
ğŸ“¤ è¯·æ±‚å·²å‘é€
ğŸ“¥ æ”¶åˆ°å“åº”:
{"success":true,"user_id":1,"balance":50.0,"order_id":123}
âœ… è®¤è¯æˆåŠŸï¼Œè®¢å• ID: 123
```

4. OLED åº”è¯¥åˆ‡æ¢åˆ°éª‘è¡Œç•Œé¢

**æ­¥éª¤ 5ï¼šæµ‹è¯• GPS ä¸ŠæŠ¥**

åœ¨éª‘è¡ŒçŠ¶æ€ä¸‹ï¼Œæ¯ 5 ç§’åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ“ GPS å·²ä¸ŠæŠ¥: 30.274567, 120.155123
```

**æ­¥éª¤ 6ï¼šæµ‹è¯•è¿˜è½¦**

1. å†æ¬¡åˆ·å¡ï¼ˆåŒä¸€å¼ å¡ï¼‰
2. è§‚å¯Ÿä¸²å£è¾“å‡ºå’Œç»“ç®—ä¿¡æ¯

---

### 3.2 MQTT æ¶ˆæ¯è°ƒè¯•

**ä½¿ç”¨ MQTT è¯Šæ–­å·¥å…·**ï¼š

1. ä¸‹è½½ [MQTTX](https://mqttx.app/)ï¼ˆè·¨å¹³å° MQTT å®¢æˆ·ç«¯ï¼‰
2. è¿æ¥åˆ° `broker.emqx.io:1883`
3. è®¢é˜…ä»¥ä¸‹ä¸»é¢˜ï¼š
   - `bike/001/heartbeat` - å¿ƒè·³åŒ…
   - `bike/001/gps` - GPS ä¸ŠæŠ¥
   - `bike/001/auth` - è®¤è¯è¯·æ±‚
   - `server/001/command` - æœåŠ¡å™¨æŒ‡ä»¤

**æµ‹è¯•æŒ‡ä»¤å‘é€**ï¼š

åœ¨ MQTTX ä¸­å‘ `server/001/command` å‘é€ï¼š

```json
{
  "action": "unlock",
  "order_id": 123,
  "balance": 50.0
}
```

åº”è¯¥çœ‹åˆ° ESP8266 è¿›å…¥éª‘è¡ŒçŠ¶æ€ã€‚

---

### 3.3 æ€§èƒ½ç›‘æ§

**å†…å­˜ä½¿ç”¨ç›‘æ§**ï¼š

åœ¨ä»£ç ä¸­æ·»åŠ ï¼š

```cpp
void printMemoryStats() {
  Serial.print("Free Heap: ");
  Serial.print(ESP.getFreeHeap());
  Serial.println(" bytes");

  Serial.print("Heap Fragmentation: ");
  Serial.print(ESP.getHeapFragmentation());
  Serial.println(" %");

  Serial.print("Free Sketch Space: ");
  Serial.print(ESP.getFreeSketchSpace());
  Serial.println(" bytes");
}

// åœ¨ loop() ä¸­å®šæœŸè°ƒç”¨
if (millis() - lastMemCheck > 60000) {
  printMemoryStats();
  lastMemCheck = millis();
}
```

**WiFi ä¿¡å·ç›‘æ§**ï¼š

```cpp
void printWiFiStats() {
  Serial.print("RSSI: ");
  Serial.print(WiFi.RSSI());
  Serial.println(" dBm");

  Serial.print("Channel: ");
  Serial.println(WiFi.channel());
}
```

---

## â“ å¸¸è§é—®é¢˜æ’æŸ¥

### 4.1 ESP8266 æ— æ³•ä¸Šä¼ ä»£ç 

**ç—‡çŠ¶**ï¼šä¸Šä¼ æ—¶æç¤º `Failed to connect`

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥ USB é©±åŠ¨**ï¼š
   - Windows: å®‰è£… [CH340 é©±åŠ¨](http://www.wch.cn/download/CH341SER_EXE.html)
   - Mac: ä½¿ç”¨ Homebrew å®‰è£…

2. **ä½¿ç”¨æ­£ç¡®çš„ä¸Šä¼ æ¨¡å¼**ï¼š
   ```
   æŒ‰ä½ ESP8266 ä¸Šçš„ FLASH æŒ‰é’®
   ç‚¹å‡» RST æŒ‰é’®
   æ¾å¼€ FLASH
   ç‚¹å‡»ä¸Šä¼ 
   çœ‹åˆ° "....._____" åæ¾å¼€ FLASH
   ```

3. **é™ä½ä¸Šä¼ é€Ÿåº¦**ï¼š
   ```
   å·¥å…· â†’ Upload Speed: 57600
   ```

---

### 4.2 GPS é•¿æ—¶é—´æ— æ³•å®šä½

**ç—‡çŠ¶**ï¼šä¸²å£ä¸€ç›´è¾“å‡º "æ­£åœ¨æœç´¢å«æ˜Ÿ..."

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥æ¥çº¿**ï¼š
   - TX/RX æ˜¯å¦æ¥å
   - æ³¢ç‰¹ç‡æ˜¯å¦ä¸º 9600
   - VCC æ˜¯å¦ä¸º 3.3V

2. **æ£€æŸ¥å¤©çº¿**ï¼š
   - æ˜¯å¦è¿æ¥æœ‰æºå¤©çº¿
   - å¤©çº¿æ˜¯å¦æ”¾åœ¨çª—è¾¹æˆ–å®¤å¤–
   - çº¢è‰² LED æ˜¯å¦é—ªçƒ

3. **ç­‰å¾…è¶³å¤Ÿæ—¶é—´**ï¼š
   - å†·å¯åŠ¨éœ€è¦ 1-5 åˆ†é’Ÿ
   - é¦–æ¬¡ä½¿ç”¨éœ€è¦æ›´é•¿æ—¶é—´

4. **ä½¿ç”¨è¾…åŠ©å®šä½**ï¼š
   - å‘é€ `$PMTK220,100*1F` å‘½ä»¤ï¼ˆéœ€è¦ç ”ç©¶ NMEA åè®®ï¼‰

---

### 4.3 RFID è¯»ä¸åˆ°å¡ç‰‡

**ç—‡çŠ¶**ï¼šåˆ·å¡åæ— ååº”

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥ç‰ˆæœ¬å·**ï¼š
   ```
   RC522 ç‰ˆæœ¬: 0x00 æˆ– 0xFF â†’ æœªæ£€æµ‹åˆ°æ¨¡å—
   RC522 ç‰ˆæœ¬: 0x91 æˆ– 0x92 â†’ æ­£å¸¸
   ```

2. **æ£€æŸ¥ 3.3V ä¾›ç”µ**ï¼š
   - ä½¿ç”¨ä¸‡ç”¨è¡¨æµ‹é‡ 3.3V å¼•è„šç”µå‹
   - ç”µå‹åº”åœ¨ 3.2V - 3.4V ä¹‹é—´

3. **è°ƒæ•´è·ç¦»**ï¼š
   - è¯»å¡è·ç¦»ä¸º 2-5cm
   - ä¿æŒå¡ç‰‡é™æ­¢

4. **æ›´æ¢å¡ç‰‡**ï¼š
   - æœ‰äº›å¡ç‰‡å¯èƒ½æŸå
   - ä½¿ç”¨æ‰‹æœº NFC æµ‹è¯•å¡ç‰‡

---

### 4.4 OLED æ˜¾ç¤ºå¼‚å¸¸

**ç—‡çŠ¶**ï¼šå±å¹•å…¨é»‘ã€å…¨ç™½æˆ–æ˜¾ç¤ºä¹±ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **è°ƒèŠ‚å¯¹æ¯”åº¦**ï¼š
   ```cpp
   u8g2.setContrast(128); // 0-255
   ```

2. **æ£€æŸ¥æ¥çº¿**ï¼š
   - ç¡®è®¤æ˜¯ SPI æ¥å£ï¼ˆ7 é’ˆï¼‰
   - å¦‚æœæ˜¯ I2Cï¼ˆ4 é’ˆï¼‰ï¼Œéœ€è¦ä¿®æ”¹ä»£ç 

3. **æµ‹è¯•ä¸åŒå­—ä½“**ï¼š
   ```cpp
   u8g2.setFont(u8g2_font_ncenB14_tr); // ä¸­æ–‡å¯èƒ½ä¸æ”¯æŒ
   u8g2.setFont(u8g2_font_7x14_tf);     // ä½¿ç”¨è‹±æ–‡å­—ä½“æµ‹è¯•
   ```

---

### 4.5 ç³»ç»Ÿè‡ªåŠ¨é‡å¯

**ç—‡çŠ¶**ï¼šè¿è¡Œä¸€æ®µæ—¶é—´åè‡ªåŠ¨é‡å¯

**åŸå› åˆ†æ**ï¼š

1. **ç”µæºä¸è¶³**ï¼š
   - æµ‹é‡ 3.3V ç”µå‹ï¼ˆä¸åº”ä½äº 3.2Vï¼‰
   - æ›´æ¢æ›´å¤§åŠŸç‡çš„ç”µæºï¼ˆ2A æˆ–ä»¥ä¸Šï¼‰

2. **WiFi åŠŸè€—è¿‡å¤§**ï¼š
   ```cpp
   WiFi.setOutputPower(10); // é™ä½åˆ° 10dBm
   WiFi.setSleepMode(WIFI_LIGHT_SLEEP); // å¯ç”¨è½»é‡çº§ç¡çœ 
   ```

3. **å †æ ˆæº¢å‡º**ï¼š
   ```cpp
   void setup() {
     // å¢åŠ æ ˆå¤§å°
     system_set_os_print(1);
   }
   ```

4. **çœ‹é—¨ç‹—è¶…æ—¶**ï¼š
   ```cpp
   // åœ¨é•¿æ—¶é—´æ“ä½œå‰å–‚ç‹—
   ESP.wdtDisable();
   // ... é•¿æ—¶é—´æ“ä½œ ...
   ESP.wdtEnable(1000);
   ```

---

### 4.6 MQTT è¿æ¥ä¸ç¨³å®š

**ç—‡çŠ¶**ï¼šMQTT é¢‘ç¹æ–­å¼€é‡è¿

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¢åŠ  Keep-Alive æ—¶é—´**ï¼š
   ```cpp
   mqttClient.setKeepAlive(60); // 60 ç§’
   ```

2. **ä½¿ç”¨é—å˜±æ¶ˆæ¯ï¼ˆLWTï¼‰**ï¼š
   ```cpp
   const char* willTopic = "bike/001/status";
   const char* willMessage = "offline";
   mqttClient.connect(
     clientId.c_str(),
     MQTT_USERNAME,
     MQTT_PASSWORD,
     willTopic,
     1,  // QoS
     true,  // retain
     willMessage
   );
   ```

3. **ä¼˜åŒ– WiFi**ï¼š
   ```cpp
   WiFi.setAutoReconnect(true);
   WiFi.persistent(true);
   ```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 5.1 é™ä½åŠŸè€—

**1. ä½¿ç”¨æ·±åº¦ç¡çœ **ï¼š

```cpp
// è¿›å…¥æ·±åº¦ç¡çœ ï¼ˆä»… RTC ä¾›ç”µï¼‰
ESP.deepSleep(30e6); // ç¡çœ  30 ç§’

// å”¤é†’åç»§ç»­æ‰§è¡Œï¼ˆéœ€è¦ç‰¹æ®Šæ¥çº¿ï¼šRST æ¥ D0ï¼‰
```

**æ³¨æ„**ï¼šæ·±åº¦ç¡çœ ä¼šæ–­å¼€ WiFi å’Œ MQTTï¼Œä¸é€‚åˆå®æ—¶åº”ç”¨ã€‚

**2. é™ä½ CPU é¢‘ç‡**ï¼š

```cpp
system_update_cpu_freq(80); // 80 MHz (é»˜è®¤)
system_update_cpu_freq(160); // 160 MHz
```

**3. å…³é—­æœªä½¿ç”¨çš„å¤–è®¾**ï¼š

```cpp
// å…³é—­ WiFi
WiFi.mode(WIFI_OFF);

// å…³é—­ä¸²å£
Serial.end();
```

---

### 5.2 æå‡å“åº”é€Ÿåº¦

**1. ä½¿ç”¨å¼‚æ­¥ HTTP è¯·æ±‚**ï¼š

```cpp
#include <ESPAsyncTCP.h>
#include <ESPAsyncWebServer.h>

AsyncWebServer server(80);

server.on("/api/test", HTTP_GET, [](AsyncWebServerRequest *request) {
  request->send(200, "application/json", "{\"status\":\"ok\"}");
});
```

**2. ä¼˜åŒ– MQTT æ¶ˆæ¯å¤§å°**ï¼š

```cpp
// ä¸æ¨è
String json = "{\"lat\":" + String(lat, 6) + ",\"lng\":" + String(lng, 6) + "}";

// æ¨èï¼ˆä½¿ç”¨ ArduinoJsonï¼‰
StaticJsonDocument<128> doc;
doc["lat"] = lat;
doc["lng"] = lng;
serializeJson(doc, json);
```

**3. å‡å°‘ä¸²å£è¾“å‡º**ï¼š

```cpp
#ifdef DEBUG_MODE
  Serial.println("Debug info");
#endif
```

---

### 5.3 æé«˜å®šä½ç²¾åº¦

**1. å¯ç”¨ WAAS/EGNOS**ï¼š

```cpp
// å‘é€ NMEA å‘½ä»¤å¯ç”¨ WAAS
GPSSerial.print("$PMTK301,2*2E\r\n");
```

**2. è¿‡æ»¤ä½ç²¾åº¦æ•°æ®**ï¼š

```cpp
if (gps.hdop.isValid() && gps.hdop.value() < 500) {
  // HDOP < 5.0ï¼Œç²¾åº¦å¯æ¥å—
  currentLat = gps.location.lat();
  currentLng = gps.location.lng();
}
```

**3. ä½¿ç”¨å¹³å‡å®šä½**ï¼š

```cpp
#define GPS_SAMPLES 10

float avgLat = 0;
float avgLng = 0;
int validSamples = 0;

for (int i = 0; i < GPS_SAMPLES; i++) {
  while (!gps.location.isUpdated()) {
    while (GPSSerial.available() > 0) {
      gps.encode(GPSSerial.read());
    }
  }

  if (gps.hdop.value() < 500) {
    avgLat += gps.location.lat();
    avgLng += gps.location.lng();
    validSamples++;
  }

  delay(1000);
}

if (validSamples > 0) {
  currentLat = avgLat / validSamples;
  currentLng = avgLng / validSamples;
}
```

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç¡¬ä»¶é…ç½®**ï¼š
   - ESP8266 å‹å·ï¼ˆNodeMCU / Wemos D1 Miniï¼‰
   - å…¶ä»–æ¨¡å—å‹å·

2. **è½¯ä»¶ç‰ˆæœ¬**ï¼š
   - Arduino IDE ç‰ˆæœ¬
   - ESP8266 æ ¸å¿ƒç‰ˆæœ¬
   - å„åº“çš„ç‰ˆæœ¬

3. **é”™è¯¯ä¿¡æ¯**ï¼š
   - å®Œæ•´çš„ä¸²å£è¾“å‡º
   - é”™è¯¯æˆªå›¾

4. **æ¥çº¿ç…§ç‰‡**ï¼š
   - æ¸…æ™°çš„æ¥çº¿ç…§ç‰‡
   - æ ‡æ³¨æ‰€æœ‰è¿æ¥

---

**æœ€åæ›´æ–°**ï¼š2025-01-11
**ç‰ˆæœ¬**ï¼šv1.0
