# 百度地图快速配置指南

## 🚀 5分钟快速接入百度地图

### 步骤 1：申请百度地图 API Key（2分钟）

1. 访问：https://lbsyun.baidu.com/
2. 登录/注册百度账号
3. 进入"控制台" → "应用管理" → "我的应用"
4. 点击"创建应用"
5. 填写信息：
   - 应用名称：`智能共享单车系统`
   - 应用类型：`浏览器端`
   - 启用服务：勾选 `JavaScript API v3.0`
   - Referer白名单：`localhost:5173`
6. 提交后复制"访问应用(AK)"

### 步骤 2：配置项目（1分钟）

在 `frontend` 目录下创建 `.env.local` 文件：

```bash
cd frontend
```

创建 `.env.local` 文件，内容如下：

```env
VITE_BAIDU_MAP_AK=你的AK密钥
VITE_API_BASE_URL=http://localhost:8000
```

**示例：**
```env
VITE_BAIDU_MAP_AK=abcdefghijklmnopqrstuvwxyz123456
VITE_API_BASE_URL=http://localhost:8000
```

### 步骤 3：重启前端服务（1分钟）

```bash
# 停止当前服务（Ctrl+C）
# 重新启动
npm run dev
```

### 步骤 4：验证效果（1分钟）

1. 访问：http://localhost:5173
2. 进入"仪表盘"页面
3. 查看地图是否正常显示
4. 应该能看到北京市地图和车辆标记点

---

## 📋 功能特性

### ✅ 已实现功能

- **百度地图显示**：真实地图，支持缩放、拖拽
- **车辆标记点**：使用自定义SVG图标
- **点击交互**：点击标记显示车辆详情
- **坐标转换**：自动将GPS坐标(WGS84)转换为百度坐标(BD09)
- **远程控制**：在弹窗中可远程开锁/关锁
- **状态区分**：不同状态使用不同颜色
  - 绿色：空闲
  - 红色：骑行中
  - 灰色：故障

### 🎨 地图控件

- **缩放控件**：左上角，支持+/-缩放
- **比例尺**：左下角，显示地图比例
- **滚轮缩放**：鼠标滚轮可缩放地图

---

## 🔧 配置说明

### 坐标系统

```
GPS (WGS84) → 火星坐标系 (GCJ02) → 百度坐标系 (BD09)
```

本项目已自动处理坐标转换，无需手动转换。

### 地图中心点

默认中心点：北京天安门（116.404, 39.915）

修改位置：`frontend/src/config/mapConfig.js`

```javascript
center: {
  lng: 116.404,  // 经度
  lat: 39.915,   // 纬度
},
```

### 缩放级别

- 范围：10-18
- 默认：15
- 数字越大，地图越详细

---

## ❓ 常见问题

### Q1: 地图显示空白，提示"API Key未配置"

**解决方案：**
1. 检查 `frontend/.env.local` 文件是否存在
2. 确认 `VITE_BAIDU_MAP_AK` 已填入正确的 AK
3. 重启前端服务：`npm run dev`

### Q2: 提示"APP不存在，AK请检查"

**解决方案：**
1. 检查 AK 是否正确复制（不要有多余空格）
2. 确认 Referer 白名单包含 `http://localhost:5173`
3. 检查应用类型是否为"浏览器端"

### Q3: 地图加载很慢

**解决方案：**
1. 检查网络连接
2. 尝试刷新浏览器
3. 清除浏览器缓存

### Q4: 车辆标记点位置偏移

**解决方案：**
- 本项目已自动转换坐标
- 如果原始数据已是 BD09，需修改代码跳过转换

### Q5: 生产环境如何配置？

**解决方案：**
1. 修改百度地图 Referer 白名单为生产域名
2. 创建生产环境的 `.env.production`
3. 或使用环境变量注入

---

## 📚 相关文档

- [百度地图 JavaScript API v3.0](https://lbsyun.baidu.com/index.php?title=jspopular3.0)
- [坐标转换说明](https://lbsyun.baidu.com/index.php?title=coordtrans)
- [百度地图API完整指南](./百度地图接入指南.md)

---

## 🎯 下一步

1. **测试地图功能**：点击标记点查看详情
2. **测试远程控制**：尝试远程开锁/关锁
3. **自定义样式**：修改地图颜色、标记点样式
4. **添加轨迹**：显示车辆行驶轨迹

---

**提示**：免费版 API 配额为 10,000 次/天，足够开发测试使用。
