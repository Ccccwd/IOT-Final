# 浏览器控制台调试步骤

## 📋 检查清单

### 第一步：打开开发者工具
1. 在浏览器中按 `F12`
2. 切换到 **Console（控制台）** 标签
3. 刷新页面（Ctrl+R）

### 第二步：查看日志输出

**你应该看到类似这样的日志：**
```
[MapConfig] 百度地图 AK 配置: jksZSsiBeT...
[MapConfig] 环境变量可用: {VITE_BAIDU_MAP_AK: true, ...}
[MapView] 开始初始化地图, AK: jksZSsiBeT...
[MapView] 加载百度地图脚本...
[MapView] 百度地图脚本加载完成
```

### 第三步：查看错误信息

**如果看到红色错误：**

#### 错误 1：AK 未设置
```
[MapConfig] 百度地图 AK 配置: 未设置
```
**原因：** 环境变量没有加载
**解决：** 重启前端服务
```bash
# 停止服务 (Ctrl+C)
cd frontend
npm run dev
```

#### 错误 2：BMap 未定义
```
ReferenceError: BMap is not defined
```
**原因：** 百度地图脚本加载失败
**检查：**
1. 打开 **Network（网络）** 标签
2. 筛选 `api.map.baidu.com`
3. 查看是否有红色失败的请求

#### 错误 3：Referer 白名单错误
```
APP不存在，AK请检查
```
**原因：** Referer 白名单配置错误
**解决：**
1. 访问百度地图控制台
2. 修改 Referer 白名单为：`localhost:5173`（不要带 http://）

### 第四步：检查网络请求

1. **打开 Network 标签**
2. **刷新页面**
3. **筛选 `baidu` 或 `api.map.baidu.com`**

**应该看到：**
```
api.map.baidu.com/api?v=3.0&ak=jksZS...
Status: 200 OK
```

**如果看到：**
- `Status: 403` → Referer 白名单错误
- `Status: 404` → AK 无效
- `(failed)` → 网络问题

### 第五步：测试地图功能

在控制台粘贴以下代码：

```javascript
// 测试 1：检查环境变量
console.log('测试 1 - 环境变量:', {
  ak: !!import.meta.env?.VITE_BAIDU_MAP_AK,
  value: import.meta.env?.VITE_BAIDU_MAP_AK?.substring(0, 15) + '...'
});

// 测试 2：检查 BMap
console.log('测试 2 - BMap 可用:', typeof BMap !== 'undefined');

// 测试 3：检查地图容器
console.log('测试 3 - 地图容器:', document.querySelector('[style*="height: 600px"]'));
```

---

## 🧪 使用测试页面

访问测试页面：
```
http://localhost:5173/test-map.html
```

**如果测试页面能显示地图：**
- ✅ AK 有效
- ✅ Referer 白名单正确
- ❌ 问题在代码中

**如果测试页面不能显示：**
- ❌ AK 无效或白名单配置错误

---

## 🎯 最可能的问题

### 问题：环境变量未生效

**症状：**
- 控制台显示 `AK: 未设置`
- 页面显示 "百度地图 API Key 未配置"

**解决：**
1. 确认 `frontend/.env.local` 文件存在
2. 文件内容：
   ```env
   VITE_BAIDU_MAP_AK=jksZSsiBeTjquXGqa14E3jCZygkS44ky
   ```
3. **重启前端服务**（必须！）

### 问题：百度地图脚本加载失败

**症状：**
- 控制台显示 `BMap is not defined`
- Network 标签中 `api.map.baidu.com` 请求失败

**解决：**
1. 检查网络连接
2. 访问百度地图控制台确认 AK 有效
3. 检查 Referer 白名单格式

---

## 💡 快速诊断

在控制台一次性运行所有检查：

```javascript
(function() {
  const results = {
    env: !!import.meta.env?.VITE_BAIDU_MAP_AK,
    bMap: typeof BMap !== 'undefined',
    container: !!document.querySelector('[style*="height: 600px"]'),
    scripts: Array.from(document.scripts).filter(s => s.src.includes('baidu'))
  };

  console.table({
    '项目': ['环境变量', 'BMap对象', '地图容器', '百度脚本'],
    '状态': [
      results.env ? '✅' : '❌',
      results.bMap ? '✅' : '❌',
      results.container ? '✅' : '❌',
      results.scripts.length > 0 ? '✅' : '❌'
    ]
  });

  console.log('详细信息:', results);
})();
```

---

按照以上步骤，你一定能找到问题所在！
